name: Binaries - Linux x64

on:
    repository_dispatch:
        types: [bin_linux_x64]

jobs:
    build:
        runs-on: ubuntu-20.04

        steps:
            - name: Download Amalgamation
              shell: bash
              run: |
                URL=$(curl -s -L \
                    -H "Accept: application/vnd.github+json" \
                    -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
                    -H "X-GitHub-Api-Version: 2022-11-28" \
                    https://api.github.com/repos/pawelsalawa/sqlite3-sqls/actions/artifacts?name=sqlite-amalgamation-${{ github.event.client_payload.INT_VER }} \
                    | jq -r '.artifacts[] | select(.workflow_run.id == ${{ github.event.client_payload.PARENT_RUN_ID }}) | .archive_download_url')
                    
                ZIP_NAME=sqlite-amalgamation-${{ github.event.client_payload.INT_VER }}.zip
                echo "Downloading $ZIP_NAME from $URL"
                curl -s -L -o $ZIP_NAME $URL
                
                unzip $ZIP_NAME
                ls -l
