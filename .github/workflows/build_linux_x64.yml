name: Binaries - Linux x64

on:
    workflow_dispatch:
        inputs:
          INT_VER:
            description: 'SQLite version as integer'
            required: true
            type: number
          PARENT_RUN_ID:
            description: 'ID of workflow that created appropriate amalgamation artifact'
            required: true
            type: number

jobs:
    build:
        runs-on: ubuntu-20.04

        steps:
            - name: Download Amalgamation
              shell: bash
              run: |
                URL=$(curl -s -L \
                    -H "Accept: application/vnd.github+json" \
                    -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
                    -H "X-GitHub-Api-Version: 2022-11-28" \
                    https://api.github.com/repos/pawelsalawa/sqlite3-sqls/actions/artifacts?name=sqlite-amalgamation-${{ inputs.INT_VER }} \
                    | jq -r '.artifacts[] | select(.workflow_run.id == ${{ inputs.PARENT_RUN_ID }}) | .archive_download_url')
                    
                ZIP_NAME=sqlite-amalgamation-${{ inputs.INT_VER }}.zip
                echo "Downloading $ZIP_NAME from $URL"
                curl -s -L -o $ZIP_NAME $URL
                
                unzip $ZIP_NAME
                ls -l
